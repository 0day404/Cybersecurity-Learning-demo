##  Weblogic  IIOP协议反序列化（CVE-2020-2551）

### 1、理解IIOP协议
*IIOP，Internet Inter-ORB Protocol(互联网内部对象请求代理协议)*

项目下三个终端分别执行命令
https://github.com/0day404/Cybersecurity-Learning-demo/IIOPDemo/
```shell
orbd -ORBInitialPort 1050 -ORBInitialHost localhost
java.exe -classpath build org.example.Server
java.exe -classpath build org.example.Client
```
总结：**IIOP协议服务端会调用Message的readObject方法，而客户端会调用writeObject方法**

### 2、利用链分析
Weblogic CVE-2020-2551 IIOP协议反序列化RCE利用链分析
参考： https://mp.weixin.qq.com/s/SQdyXS1LNOgfP7QD93XGaw
**实现Jndi注入**：*JtaTransactionManager*#*readObject:1192*
**实现IIOP协议**：*IIOPInputStream:1725*
入口source点：*readObject:314*, *ObjectStreamClass* (*weblogic.utils.io*)

```java
readObject:1192, JtaTransactionManager (com.bea.core.repackaged.springframework.transaction.jta)
    invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
    invoke:57, NativeMethodAccessorImpl (sun.reflect)
    invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
    invoke:601, Method (java.lang.reflect)
    readObject:314, ObjectStreamClass (weblogic.utils.io)
    readValueData:281, ValueHandlerImpl (weblogic.corba.utils)
    readValue:93, ValueHandlerImpl (weblogic.corba.utils)
    read_value:2128, IIOPInputStream (weblogic.iiop)
    read_value:1936, IIOPInputStream (weblogic.iiop)
    read_value_internal:220, AnyImpl (weblogic.corba.idl)
    read_value:115, AnyImpl (weblogic.corba.idl)
    read_any:1648, IIOPInputStream (weblogic.iiop)
    read_any:1641, IIOPInputStream (weblogic.iiop)
    _invoke:84, _NamingContextAnyImplBase (weblogic.corba.cos.naming)
    invoke:249, CorbaServerRef (weblogic.corba.idl)
    invoke:230, ClusterableServerRef (weblogic.rmi.cluster)
    run:522, BasicServerRef$1 (weblogic.rmi.internal)
    doAs:363, AuthenticatedSubject (weblogic.security.acl.internal)
    runAs:146, SecurityManager (weblogic.security.service)
    handleRequest:518, BasicServerRef (weblogic.rmi.internal)
    run:118, WLSExecuteRequest (weblogic.rmi.internal.wls)
    execute:256, ExecuteThread (weblogic.work)
    run:221, ExecuteThread (weblogic.work)
```